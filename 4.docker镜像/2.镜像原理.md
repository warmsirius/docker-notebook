# 2. 镜像原理

## 2.1 Union FS(联合文件系统)
Union FS(联合文件系统): Union文件系统(Union FS)是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下。

Union 文件系统是 Docker镜像的基础。

镜像可以通过分层来继承，基于基础镜像(没有父镜像)，可以制作各种具体的应用镜像。

### 特性

一次同时加载多个文件系统，但是外表看起来，只能看到1个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。


## 2.2 Docker加载镜像原理

docker镜像实际上是一层一层的文件系统组成，这种层级的文件系统是Union FS。

### bootfs(boot file system)
bootfs(boot file system)主要包含 bootloader 和 kernel。

#### bootloader

主要是引导加载 kernel，Linux刚启动时会加载 bootfs文件系统，在Docker镜像最底层是 bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含 boot加载器和内核。

当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs转交给内核，此时系统也会卸载 bootfs。

### rootfs(root file system)

在bootfs之上，包含的就是典型 Linux系统中的 /dev、/proc、/bin、/etc等标准目录和文件。

rootfs就是各种不同操作系统发行版本，比如Ubuntu、CentOS等。

![](../assets/bootfs和rootfs.png)


**问题: 平时安装虚拟机的CentOS都是好几个G，为什么docker才200M？**

> 答: 对于1个精简OS，rootfs可以很小，主需要包括 最基本的命令、工具和程序就可以了，因为底层直接用 Host 的 kernel，自己只需要提供 rootfs就行了。
>
> 由此可见，对于不同的Linux发行版，bootfs基本是一致的，rootfs会有差别，因此不同发行版本可以公用 bootfs。
